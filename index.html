<!DOCTYPE html>
<html>
	<head>
		 <title>Webcam Stuff</title>
		 <style>
			html, body{ margin: 0; padding: 0; }
			video, .overlay{ position: absolute; top: 0; left: 0; }
			#box{ border: 1px solid red; height: 10px; width: 10px; transition: all 0.1; }
			.overlay{ opacity: 0; z-index: 5; }
			#options{ position: absolute; bottom: 0;}
			.option{ float: left; width: 100px; border: 1px solid #343434;  margin-left: 20px;}
			#options h3{ margin-left: 20px; }
		 </style>
	</head>
	<body>
		<video id="video" autoplay loop></video>
		<div id="box" class="overlay"></div>
		<img src="images/glasses.png" id="glasses" class="overlay">
		<div id="options">
			<h3>Select any object:</h3>
			<img src="images/glasses.png" class="option">
			<img src="images/g2.png" class="option">
		</div>
		<script src="js/objectdetect.js"></script>
		<script src="js/objectdetect.frontalface.js"></script>		
		<script type="text/javascript">
			
			navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;
			window.URL = window.URL || window.webkitURL;
			if (navigator.getUserMedia === undefined) {
				alert("Browser doesn't support getUserMedia");
			}
			
			window.onload = function(){
				var video = document.getElementById('video'),
				box = document.getElementById('glasses'),
				detector;

				navigator.getUserMedia({video: true}, function (stream) {
					video.src = window.URL.createObjectURL(stream);
					video.addEventListener('canplay', draw);
				}, function() {});

				function draw(){
					if (video.paused) video.play();
					if (video.readyState === video.HAVE_ENOUGH_DATA && video.videoWidth > 0) {		
						try {
							var coords = detector.detect(video, 1);
							//console.log(coords[0]);
							if(coords[0]){
								box.style.opacity = 1;
								var wFactor = video.videoWidth / detector.canvas.width, hFactor = video.videoHeight / detector.canvas.height;
								var faceWidth = coords[0][2] * wFactor,
								faceHeight = coords[0][3] * hFactor;
								box.style.left = (video.offsetLeft + coords[0][0] * wFactor + 0.125 * faceWidth) + 'px';
								box.style.top = (video.offsetTop + coords[0][1] * hFactor + 0.33 * faceHeight) + 'px';
								box.style.width = (0.75 * faceWidth) + 'px';
								//box.style.height = faceHeight + 'px';					
							} else{
								box.style.opacity = 0;
							}
						} catch(error){
							detector = new objectdetect.detector((60 * video.videoWidth / video.videoHeight), 60, 1.1, objectdetect.frontalface);
						}
					}
					requestAnimationFrame(draw);
				}

				var options = document.getElementsByClassName('option');
				for (var i = 0; i < options.length; i++) {
					console.log(options[i]);
					options[i].addEventListener('click', function(){
						console.log(this.getAttribute('src'));
						box.src = this.getAttribute('src');
					});
				}
			}
		</script>
	</body>
</html>